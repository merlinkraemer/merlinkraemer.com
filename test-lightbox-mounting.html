<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lightbox Mounting Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      .info {
        color: blue;
      }
      button {
        margin: 5px;
        padding: 10px;
      }
      .test-results {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 3px;
        margin: 10px 0;
      }
      .test-instructions {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <h1>Lightbox Mounting Test</h1>

    <div class="test-instructions">
      <h3>üß™ Test Instructions</h3>
      <ol>
        <li>
          <strong>Open the main app:</strong>
          <a href="http://localhost:5174" target="_blank"
            >http://localhost:5174</a
          >
        </li>
        <li><strong>Open DevTools Console</strong> to see logs</li>
        <li><strong>Click any image</strong> to open lightbox</li>
        <li><strong>Close lightbox</strong> (ESC or click outside)</li>
        <li><strong>Reopen same image</strong> - should load INSTANTLY</li>
        <li>
          <strong>Try different images</strong> - should also load instantly
        </li>
      </ol>
    </div>

    <div class="test-section">
      <h3>Expected Results</h3>
      <div class="test-results">
        <div class="success">‚úÖ First open: Normal loading with spinners</div>
        <div class="success">
          ‚úÖ Subsequent opens: Instant loading (no spinners)
        </div>
        <div class="success">‚úÖ State preserved: Loading states maintained</div>
        <div class="success">‚úÖ No re-mounting: Component stays mounted</div>
        <div class="success">‚úÖ Swiper state: Navigation works smoothly</div>
      </div>
    </div>

    <div class="test-section">
      <h3>Console Monitoring</h3>
      <div class="test-results">
        <div class="info">Watch for these console messages:</div>
        <div class="info">
          ‚Ä¢ "Gallery: Loading from cache" - Should see this on subsequent opens
        </div>
        <div class="info">
          ‚Ä¢ "Gallery: Data saved to cache" - Should see this after first load
        </div>
        <div class="info">
          ‚Ä¢ No "Service Worker: Cached new asset" on subsequent opens
        </div>
      </div>
    </div>

    <div class="test-section">
      <h3>Performance Tests</h3>
      <button onclick="testComponentMounting()">Test Component Mounting</button>
      <button onclick="testStatePersistence()">Test State Persistence</button>
      <button onclick="testMemoryUsage()">Test Memory Usage</button>
      <div id="performance-results" class="test-results"></div>
    </div>

    <div class="test-section">
      <h3>Debugging Tools</h3>
      <button onclick="checkReactComponents()">Check React Components</button>
      <button onclick="checkImageCache()">Check Image Cache</button>
      <button onclick="simulateLightboxCycle()">Simulate Lightbox Cycle</button>
      <div id="debug-results" class="test-results"></div>
    </div>

    <script>
      function testComponentMounting() {
        const results = document.getElementById("performance-results");

        // Check if React DevTools is available
        if (window.__REACT_DEVTOOLS_GLOBAL_HOOK__) {
          results.innerHTML = `
            <div class="success">‚úÖ React DevTools detected</div>
            <div class="info">Check Components tab to see if Lightbox stays mounted</div>
            <div class="info">Look for: Lightbox component should persist when closed</div>
          `;
        } else {
          results.innerHTML = `
            <div class="error">‚ùå React DevTools not detected</div>
            <div class="info">Install React DevTools extension for better debugging</div>
          `;
        }
      }

      function testStatePersistence() {
        const results = document.getElementById("performance-results");

        // Test if we can detect component state
        const testKey = "lightbox_mounting_test";
        const testData = {
          timestamp: Date.now(),
          test: "mounting_persistence",
        };

        try {
          localStorage.setItem(testKey, JSON.stringify(testData));
          const retrieved = JSON.parse(localStorage.getItem(testKey));

          if (retrieved && retrieved.test === "mounting_persistence") {
            results.innerHTML = `
              <div class="success">‚úÖ State persistence working</div>
              <div class="info">LocalStorage test passed</div>
              <div class="info">Component state should also persist</div>
            `;
          } else {
            results.innerHTML = `
              <div class="error">‚ùå State persistence failed</div>
              <div class="info">LocalStorage test failed</div>
            `;
          }

          localStorage.removeItem(testKey);
        } catch (err) {
          results.innerHTML = `
            <div class="error">‚ùå State persistence error</div>
            <div class="info">Error: ${err.message}</div>
          `;
        }
      }

      function testMemoryUsage() {
        const results = document.getElementById("performance-results");

        if (performance.memory) {
          const memory = performance.memory;
          const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
          const totalMB = Math.round(memory.totalJSHeapSize / 1024 / 1024);
          const limitMB = Math.round(memory.jsHeapSizeLimit / 1024 / 1024);

          results.innerHTML = `
            <div class="info">Memory Usage:</div>
            <div class="info">Used: ${usedMB} MB</div>
            <div class="info">Total: ${totalMB} MB</div>
            <div class="info">Limit: ${limitMB} MB</div>
            <div class="info">Usage: ${Math.round(
              (usedMB / limitMB) * 100
            )}%</div>
            <div class="info">Note: Memory should be stable when lightbox is hidden</div>
          `;
        } else {
          results.innerHTML =
            '<div class="error">Memory API not available</div>';
        }
      }

      function checkReactComponents() {
        const results = document.getElementById("debug-results");

        if (window.__REACT_DEVTOOLS_GLOBAL_HOOK__) {
          results.innerHTML = `
            <div class="success">‚úÖ React DevTools available</div>
            <div class="info">Open DevTools ‚Üí Components tab</div>
            <div class="info">Look for Lightbox component in the tree</div>
            <div class="info">It should stay mounted when closed</div>
          `;
        } else {
          results.innerHTML = `
            <div class="error">‚ùå React DevTools not available</div>
            <div class="info">Install React DevTools extension</div>
          `;
        }
      }

      function checkImageCache() {
        const results = document.getElementById("debug-results");

        // Check if we can access any global caches
        const caches = [];
        if (window.imageCache) caches.push("imageCache");
        if (window.__REACT_DEVTOOLS_GLOBAL_HOOK__)
          caches.push("React DevTools");

        if (caches.length > 0) {
          results.innerHTML = `
            <div class="success">‚úÖ Available caches:</div>
            <div class="info">${caches.join(", ")}</div>
            <div class="info">Image cache should persist across lightbox sessions</div>
          `;
        } else {
          results.innerHTML = `
            <div class="info">No accessible caches detected</div>
            <div class="info">Caches may be internal to React components</div>
          `;
        }
      }

      function simulateLightboxCycle() {
        const results = document.getElementById("debug-results");

        results.innerHTML = `
          <div class="info">Simulating lightbox cycle...</div>
          <div class="info">1. Opening lightbox (should load from cache)</div>
          <div class="info">2. Closing lightbox (should hide, not unmount)</div>
          <div class="info">3. Reopening lightbox (should be instant)</div>
          <div class="info">Check the main app to see the actual behavior</div>
        `;

        // Simulate timing
        setTimeout(() => {
          results.innerHTML += `
            <div class="success">‚úÖ Cycle simulation complete</div>
            <div class="info">Now test the actual lightbox in the main app</div>
          `;
        }, 2000);
      }

      // Initial checks
      testComponentMounting();
      checkImageCache();
    </script>
  </body>
</html>
